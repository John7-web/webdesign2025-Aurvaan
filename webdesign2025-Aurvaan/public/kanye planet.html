<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Saturn Simulator — Drake Impact (Lil Baby Explosion)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: black;
      font-family: system-ui, sans-serif;
    }
    #info {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #ccc;
      font-size: 13px;
      opacity: 0.9;
      z-index: 10;
      text-align: center;
    }
    #resetBtn {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      background: #111;
      color: #fff;
      border: 1px solid #555;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 13px;
    }
  </style>
<style>
  #flash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: white;
    opacity: 0;
    pointer-events: none;
    z-index: 999;
    transition: opacity 0.06s ease-out, transform 0.06s ease-out;
    transform: scale(1);
  }
</style>
</head>
<body>
<div id="flash"></div>
<div id="info">Drake Cube → Kanye Planet (Saturn)<br>Drag = rotate • Scroll = zoom</div>
<button id="resetBtn">Reset Explosion</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.124.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.124.0/examples/js/controls/OrbitControls.js"></script>

<script>
var scene, camera, renderer, controls;
var sun, sunLight, saturn, rings, drakeCube;
var moons = [];
var explosionParticles = null;
var impactHappened = false;
var meteorVelocity = new THREE.Vector3(-0.03, 0, 0);
var animationId;
var originalCameraPosition;
var slowMotion = false;

function initScene() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 5000);
  camera.position.set(0, 3, 14);
  originalCameraPosition = camera.position.clone();

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.outputEncoding = THREE.sRGBEncoding;
  document.body.appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.enablePan = false;

  sunLight = new THREE.DirectionalLight(0xffffff, 2.5);
  sunLight.position.set(10, 0, 0);
  scene.add(sunLight);
  scene.add(new THREE.AmbientLight(0x111111));

  var texLoader = new THREE.TextureLoader();

  sun = new THREE.Mesh(
    new THREE.SphereGeometry(1.4, 48, 48),
    new THREE.MeshStandardMaterial({
      map: texLoader.load('https://th.bing.com/th/id/R.3f2689ba00a2f677b83cd38e96500c29?rik=Kl%2bGPzOZH0q0ug&pid=ImgRaw&r=0'),
      emissive: new THREE.Color(0xffaa33),
      emissiveMap: texLoader.load('https://i.pinimg.com/736x/05/89/13/0589130247c9a818bb3a4db50e5baa0f.jpg'),
      emissiveIntensity: 1.2
    })
  );
  sun.position.set(10, 0, 0);
  scene.add(sun);

  saturn = new THREE.Mesh(
    new THREE.SphereGeometry(1.8, 128, 128),
    new THREE.MeshPhongMaterial({
      map: texLoader.load('https://th.bing.com/th/id/OIP.c0lBCBMdk6x2yYLpKhV5swHaFj?w=218&h=182&c=7&r=0&o=5&cb=ucfimg2&pid=1.7&ucfimg=1'),
      shininess: 2
    })
  );
  saturn.rotation.z = THREE.Math.degToRad(26.7);
  scene.add(saturn);

  rings = new THREE.Mesh(
    new THREE.RingGeometry(2.2, 3.9, 256),
    new THREE.MeshBasicMaterial({
      map: texLoader.load('https://tse4.mm.bing.net/th/id/OIP.pM8t8KZlIt-JDZEMey0t8AHaHa?cb=ucfimg2&ucfimg=1&rs=1&pid=ImgDetMain&o=7&rm=3'),
      side: THREE.DoubleSide,
      transparent: true
    })
  );
  rings.rotation.x = Math.PI / 2;
  rings.rotation.z = THREE.Math.degToRad(26.7);
  saturn.add(rings);

  // MULTIPLE MOONS SETUP
  var moonData = [];
  var moonCount = 8;
  for (var i = 0; i < moonCount; i++) {
    moonData.push({
      size: THREE.MathUtils.randFloat(0.12, 0.38),
      distance: 3.8 + i * 0.8 + Math.random() * 0.3,
      speed: 0.001 + Math.random() * 0.0025,
      tilt: THREE.MathUtils.randFloat(-0.4, 0.4)
    });
  }

  moonData.forEach(function(data) {
    var pivot = new THREE.Object3D();
    pivot.rotation.x = data.tilt;
    saturn.add(pivot);

    var moon = new THREE.Mesh(
      new THREE.SphereGeometry(data.size, 48, 48),
      new THREE.MeshStandardMaterial({
        map: texLoader.load('https://tse4.mm.bing.net/th/id/OIP.PEcpzql-aS5y4q-EI3y91gHaHY?rs=1&pid=ImgDetMain&o=7&rm=3'),
        roughness: 1
      })
    );
    moon.position.x = data.distance;
    pivot.add(moon);

    moons.push({ pivot: pivot, speed: data.speed });
  });

  drakeCube = new THREE.Mesh(
    new THREE.BoxGeometry(1.2, 1.2, 1.2),
    new THREE.MeshStandardMaterial({
      map: texLoader.load('https://townsquare.media/site/812/files/2021/07/attachment-drake1.jpg?w=1200'),
      roughness: 0.4,
      metalness: 0.2
    })
  );
  drakeCube.position.set(12, 0, 0);
  scene.add(drakeCube);

  // stars
  var starsGeo = new THREE.BufferGeometry();
  var count = 10000;
  var pos = new Float32Array(count * 3);
  for (var i = 0; i < pos.length; i++) pos[i] = (Math.random() - 0.5) * 4000;
  starsGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
  scene.add(new THREE.Points(starsGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 0.7 })));
}

var cycleStart = Date.now();
function updateSun() {
  var t = ((Date.now() - cycleStart) % 15000) / 15000 * Math.PI * 2;
  var x = Math.cos(t) * 12;
  var z = Math.sin(t) * 12;
  sun.position.set(x, 0, z);
  sunLight.position.set(x, 0, z);
}

function animate() {
  animationId = requestAnimationFrame(animate);

  var delta = slowMotion ? 0.02 : 1;

  if (!impactHappened) {
    saturn.rotation.y += 0.0004 * delta;
    moons.forEach(function(m) {
      m.pivot.rotation.y += m.speed * delta;
    });

    drakeCube.rotation.x += 0.01 * delta;
    drakeCube.rotation.y += 0.02 * delta;

    drakeCube.position.addScaledVector(meteorVelocity, delta);

    if (drakeCube.position.distanceTo(saturn.position) < 2.2) {
      triggerExplosion();
    }
  }

  if (explosionParticles) {
    var arr = explosionParticles.geometry.attributes.position.array;
    var vel = explosionParticles.userData.vel;
    for (var i = 0; i < vel.length; i++) {
      arr[i * 3] += vel[i].x * delta;
      arr[i * 3 + 1] += vel[i].y * delta;
      arr[i * 3 + 2] += vel[i].z * delta;
    }
    explosionParticles.geometry.attributes.position.needsUpdate = true;
  }

  updateSun();
  controls.update();
  renderer.render(scene, camera);
}

function triggerExplosion() {
  var flash = document.getElementById('flash');
  var pulses = [0, 90, 180];
  var shakeIntensity = 0.6;

  pulses.forEach(function(delay) {
    setTimeout(function () {
      flash.style.opacity = '1';
      slowMotion = true; // enable slow-motion during pulse

      var shakeStart = Date.now();
      var shakeAnim = setInterval(function() {
        var elapsed = Date.now() - shakeStart;
        if (elapsed > 80) {
          clearInterval(shakeAnim);
          camera.position.copy(originalCameraPosition);
          slowMotion = false; // restore normal speed after pulse
          return;
        }
        camera.position.x = originalCameraPosition.x + (Math.random() - 0.5) * shakeIntensity;
        camera.position.y = originalCameraPosition.y + (Math.random() - 0.5) * shakeIntensity;
        camera.position.z = originalCameraPosition.z + (Math.random() - 0.5) * shakeIntensity;
      }, 16);

      setTimeout(function () {
        flash.style.opacity = '0';
      }, 80);
    }, delay);
  });

  impactHappened = true;
  scene.remove(drakeCube);
  scene.remove(saturn);

  var texLoader = new THREE.TextureLoader();
  var lilBabyTex = texLoader.load('https://i8.amplience.net/i/naras/lil-baby_MI0005107873-MN0003353669');

  var count = 500;
  var geo = new THREE.BufferGeometry();
  var pos = new Float32Array(count * 3);
  var vel = [];

  for (var i = 0; i < count; i++) {
    pos[i * 3] = 0;
    pos[i * 3 + 1] = 0;
    pos[i * 3 + 2] = 0;
    vel.push(new THREE.Vector3(
      (Math.random() - 0.5) * 0.5,
      (Math.random() - 0.5) * 0.5,
      (Math.random() - 0.5) * 0.5
    ));
  }

  geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
  var spriteMat = new THREE.PointsMaterial({
    map: lilBabyTex,
    size: 0.8,
    sizeAttenuation: true,
    transparent: true
  });
  explosionParticles = new THREE.Points(geo, spriteMat);
  explosionParticles.userData.vel = vel;
  scene.add(explosionParticles);
}

function resetSimulation() {
  document.getElementById('flash').style.opacity = '0';
  slowMotion = false;
  cancelAnimationFrame(animationId);
  while (scene.children.length > 0) scene.remove(scene.children[0]);
  explosionParticles = null;
  impactHappened = false;
  meteorVelocity.set(-0.03, 0, 0);
  initScene();
  animate();
}

document.getElementById('resetBtn').onclick = resetSimulation;

window.addEventListener('resize', function () {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

initScene();
animate();
</script>
</body>
</html>