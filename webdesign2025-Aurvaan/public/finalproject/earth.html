<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Earth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      min-height: 100%;
      overflow-x: hidden;
      background: #000;
      color: #ddd;
      font-family: system-ui, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* 3D viewer container */
    #viewer {
      width: 100%;
      height: 60vh;
      min-height: 480px;
      position: relative;
      background: radial-gradient(ellipse at center, #02030a 0%, #000 60%);
      overflow: hidden;
      transition: height 360ms ease; /* smooth height transitions */
      will-change: height;
    }

    #info {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #ccc;
      font-size: 13px;
      opacity: 0.95;
      z-index: 10;
      text-align: center;
      pointer-events: none;
    }

    /* Research / content area */
    #content {
      max-width: 920px;
      margin: 24px auto 72px;
      padding: 20px 22px;
      background: rgba(255,255,255,0.02);
      border-radius: 8px;
      box-shadow: 0 6px 30px rgba(0,0,0,0.6);
      color: #ddd;
      line-height: 1.6;
    }

    #content h1, #content h2 { color: #fff; margin: 0.8rem 0 0.4rem; }
    #content p, #content ul { margin: 0.5rem 0; color: #cfd8dc; }
    #content ul { padding-left: 1.2rem; }
    #content small { color: #9ea7ab; }

    /* Content area transitions (no collapse UI) */
    #content {
      transition: max-height 300ms ease, padding 300ms ease, opacity 300ms ease;
      max-height: 1500px;
      position: relative;
      z-index: 2;
    }
  </style>
</head>
<body>
<div id="viewer">
  <div id="info">Earth<br>Drag = rotate • Scroll = zoom</div>
</div>

<div id="content">
  <h1>Earth — In-depth Overview</h1>
  <p>Earth is the third planet from the Sun and the only known world to support life. This section summarizes Earth's origin, structure, atmosphere, hydrosphere, climate system, biosphere, and human impacts with references to major sources for further reading.</p>

  <h2>Formation & Evolution</h2>
  <p>Earth formed about 4.54 billion years ago by accretion of material in the early Solar System. Differentiation produced a metallic core and silicate mantle; subsequent bombardment, volcanism, and plate tectonics shaped the crust and surface environments where life later emerged.</p>

  <h2>Internal Structure</h2>
  <p>Earth has a layered interior: a solid inner core (~1,220 km radius) and a liquid outer core (~2,260 km thick) rich in iron and nickel, a viscous silicate mantle (~2,900 km thick) that convects and drives plate tectonics, and a thin solid crust (continental and oceanic).</p>

  <h2>Atmosphere</h2>
  <p>The atmosphere is primarily nitrogen (78%) and oxygen (21%), with trace greenhouse gases such as CO₂, methane, and water vapor. Layers (troposphere, stratosphere, mesosphere, thermosphere) control weather, climate, and protect the surface from harmful solar radiation.</p>

  <h2>Hydrosphere</h2>
  <p>About 71% of Earth's surface is covered by oceans, which regulate climate, store heat, and host the bulk of marine life. The water cycle (evaporation, transport, precipitation, runoff) redistributes water and energy globally.</p>

  <h2>Climate & Weather</h2>
  <p>Climate arises from interactions between the atmosphere, oceans, cryosphere, land surface, and biosphere. Human activities have increased greenhouse gas concentrations, causing global warming and shifts in weather patterns that affect ecosystems and societies.</p>

  <h2>Biosphere & Life</h2>
  <p>Life on Earth ranges from single-celled microbes to complex multicellular organisms. Biological processes (photosynthesis, respiration, nutrient cycles) profoundly influence planetary chemistry and the atmosphere.</p>

  <h2>Orbit, Rotation & Seasons</h2>
  <p>Earth orbits the Sun every ~365.25 days and rotates once every ~23.93 hours. The axial tilt (~23.44°) produces seasons by changing the Sun’s angle and day length across latitudes.</p>

  <h2>Magnetic Field</h2>
  <p>The geomagnetic field is generated by convection in the liquid outer core (geodynamo). It shields the surface from charged particles and helps retain the atmosphere.</p>

  <h2>Human Impact</h2>
  <p>Human activities have altered land cover, biogeochemical cycles, and the climate. Key concerns include biodiversity loss, pollution, sea-level rise, and resource sustainability.</p>

  <h2>Quick Facts</h2>
  <ul>
    <li>Mean radius: ~6,371 km</li>
    <li>Mass: ~5.97 × 10<sup>24</sup> kg</li>
    <li>Average surface temperature: ~14 °C (varies widely)</li>
    <li>Main atmospheric gases: 78% N₂, 21% O₂, ~1% others</li>
    <li>Age: ~4.54 billion years</li>
  </ul>

  <p><small>Sources and further reading: NASA Earth Observatory, NOAA, IPCC Assessment Reports, USGS—consult these for primary datasets and peer-reviewed research.</small></p>
</div>

<!-- Three.js r124 (NO modules, sandbox-safe) -->
<script src="https://cdn.jsdelivr.net/npm/three@0.124.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.124.0/examples/js/controls/OrbitControls.js"></script>

<script>
  console.assert(window.THREE, 'THREE failed to load');
  console.assert(THREE.OrbitControls, 'OrbitControls failed to load');

  // ===================== SCENE =====================
  var scene = new THREE.Scene();

  var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 5000);
  camera.position.set(0, 1.6, 6);

  var viewer = document.getElementById('viewer');

  var renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(viewer.clientWidth, viewer.clientHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.outputEncoding = THREE.sRGBEncoding;
  renderer.domElement.style.display = 'block';
  viewer.appendChild(renderer.domElement);

  // Ensure camera uses viewer aspect ratio
  camera.aspect = viewer.clientWidth / viewer.clientHeight;
  camera.updateProjectionMatrix();

  var controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.enablePan = false;  

  // ===================== LIGHTING =====================

  var sunLight = new THREE.DirectionalLight(0xffffff, 2.5);
  scene.add(sunLight);
  scene.add(new THREE.AmbientLight(0x111111));

  // ===================== SUN (VISIBLE) =====================

  var sun = new THREE.Mesh(
    new THREE.SphereGeometry(0, 0, 0),
    new THREE.MeshBasicMaterial({
      map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/sun.jpg')
    })
  );
  scene.add(sun);

  // ===================== EARTH =====================

  var loader = new THREE.TextureLoader();

  var earth = new THREE.Mesh(
    new THREE.SphereGeometry(1, 64, 64),
    new THREE.MeshPhongMaterial({
      map: loader.load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg'),
      normalMap: loader.load('https://threejs.org/examples/textures/planets/earth_normal_2048.jpg')
    })
  );
  earth.rotation.z = THREE.Math.degToRad(23.44);
  scene.add(earth);

  // ===================== CLOUD LAYER =====================

  var clouds = new THREE.Mesh(
    new THREE.SphereGeometry(1.04, 64, 64),
    new THREE.MeshPhongMaterial({
      map: loader.load('https://threejs.org/examples/textures/planets/earth_clouds_1024.png'),
      transparent: true,
      opacity: 0.75,
      depthWrite: false
    })
  );
  clouds.renderOrder = 2;
  scene.add(clouds);

  // ===================== CITY NIGHT LIGHTS (SAFE) =====================

  var cityLights = new THREE.Mesh(
    new THREE.SphereGeometry(1.002, 64, 64),
    new THREE.MeshBasicMaterial({
      map: loader.load('https://threejs.org/examples/textures/planets/earth_lights_2048.png'),
      transparent: true,
      opacity: 0.9
    })
  );
  cityLights.renderOrder = 1;
  scene.add(cityLights);

  // ===================== STARS =====================

  var starsGeo = new THREE.BufferGeometry();
  var stars = new Float32Array(10000 * 3);
  for (var i = 0; i < stars.length; i++) stars[i] = (Math.random() - 0.5) * 3000;
  starsGeo.setAttribute('position', new THREE.BufferAttribute(stars, 3));
  scene.add(new THREE.Points(starsGeo, new THREE.PointsMaterial({ size: 0.7 })));

  // ===================== ASTRONOMY =====================

  // Simulated fast day/night cycle (15 seconds per full cycle)
  var cycleStart = Date.now();
  var CYCLE_DURATION = 15000; // ms

  function updateSun() {
    var elapsed = (Date.now() - cycleStart) % CYCLE_DURATION;
    var angle = (elapsed / CYCLE_DURATION) * Math.PI * 2;

    var x = Math.cos(angle) * 10;
    var z = Math.sin(angle) * 10;

    sun.position.set(x, 0, z);
    sunLight.position.copy(sun.position);

    // Smooth city-light fade based on sun angle
    // dayFactor: 1 = full day, 0 = full night
    var dayFactor = THREE.Math.clamp((x / 10 + 1) / 2, 0, 1);
    // Lights strongest at night, fade smoothly at dawn/dusk
    cityLights.material.opacity = Math.pow(1 - dayFactor, 1.5);
  }

  // ===================== RESIZE =====================

  window.addEventListener('resize', function () {
    renderer.setSize(viewer.clientWidth, viewer.clientHeight);
    camera.aspect = viewer.clientWidth / viewer.clientHeight;
    camera.updateProjectionMatrix();
  });

  // ===================== LOOP =====================

  function animate() {
    requestAnimationFrame(animate);

    earth.rotation.y += 0.0007;
    clouds.rotation.y += 0.0009;

    // Earth stays centered (Sun moves instead)
    earth.position.set(0, 0, 0);
    clouds.position.copy(earth.position);
    cityLights.position.copy(earth.position);
    
    updateSun();



    controls.update();
    renderer.render(scene, camera);
  }

  animate();


</script>
</body>
</html>
