<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive 3D Stellar Classification</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        
        /* UI Overlay Container */
        #ui-container {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none; /* Let clicks pass through to canvas if needed */
            z-index: 10;
        }

        /* Star Selection Buttons */
        .controls {
            pointer-events: auto;
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        button.active {
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            box-shadow: 0 0 20px currentColor;
        }

        /* Collapsible Info Panel */
        #info-panel {
            pointer-events: auto;
            width: 350px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            max-height: 40px; /* Collapsed height */
        }

        #info-panel.expanded {
            max-height: 600px;
        }

        #info-header {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        #info-header:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        #info-content {
            padding: 15px;
        }

        /* Data Table */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            color: #aaa;
            font-weight: normal;
        }

        .highlight {
            color: #4db8ff;
            font-weight: bold;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s;
        }
        
        #info-panel.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        h2 { margin-top: 0; font-size: 1.2rem; border-bottom: 1px solid #444; padding-bottom: 5px; }
        p { color: #ccc; line-height: 1.4; font-size: 0.9rem; }

        /* Bottom information panel (similar to blackholes.html) */
        #info-bottom {
            background: rgba(6,6,8,0.95);
            color: #fff;
            padding: 14px 18px;
            font-family: sans-serif;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.6);
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            max-height: 320px; /* expanded */
            transition: max-height 300ms ease, padding 300ms ease;
            z-index: 20;
        }
        /* Collapsed state */
        #info-bottom.collapsed {
            max-height: 44px; /* small bar */
            padding-top: 8px;
            padding-bottom: 8px;
        }

        #info-bottom h2 { margin: 0 0 6px 0; font-size: 1rem; }
        #info-bottom h3 { margin: 8px 0 6px 0; font-size: 0.95rem; color: #fff; }
        #info-bottom p { margin: 6px 0 8px 0; color:#ddd; font-size:0.95rem; }
        #info-bottom ul { margin: 4px 0 0 18px; color:#ddd; }
        #info-bottom .info-section { margin-top: 8px; color: #ddd; }
        #info-bottom hr { border: none; border-top: 1px solid rgba(255,255,255,0.06); margin: 10px 0; }

        /* Toggle button */
        .info-toggle {
            position: absolute;
            right: 10px;
            top: 8px;
            background: rgba(20,20,22,0.25);
            border: 1px solid rgba(255,255,255,0.06);
            color: #fff;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            line-height: 1;
            backdrop-filter: blur(4px);
        }

        @media (max-width:700px) {
            #info-bottom { padding: 12px; font-size: 0.95rem; }
        }
    </style>
</head>
<body>

    <div id="ui-container">
        <div class="controls">
            <button onclick="changeStar('M')" style="border-color: #ff4d4d;">Red Dwarf</button>
            <button onclick="changeStar('G')" class="active" style="border-color: #ffdd00;">Yellow Dwarf</button>
            <button onclick="changeStar('O')" style="border-color: #4d94ff;">Blue Giant</button>
        </div>

        <div id="info-panel" onclick="toggleInfo()">
            <div id="info-header">
                <span>Stellar Data Log</span>
                <span class="toggle-icon">▼</span>
            </div>
            <div id="info-content">
                <h2 id="star-name">Sun (G-Type)</h2>
                <p id="star-desc">A yellow dwarf star. It is the most familiar type of star to us, supporting life on Earth.</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Class</th>
                            <th>Color</th>
                            <th>Temp (K)</th>
                            <th>Lifespan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="row-m"><td>M (Red)</td><td>Red</td><td>~3,000</td><td>Trillions yrs</td></tr>
                        <tr id="row-g" class="highlight"><td>G (Sun)</td><td>Yellow</td><td>~5,800</td><td>10 Billion yrs</td></tr>
                        <tr id="row-o"><td>O (Blue)</td><td>Blue</td><td>~30,000+</td><td>~10 Million yrs</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bottom information panel (Sun/Stellar info) -->
    <aside id="info-bottom" aria-label="Sun Information">
        <button id="infoToggle" class="info-toggle" aria-expanded="true" aria-controls="info-bottom" title="Collapse panel">▲</button>
        <h2>Sun & Stellar Information</h2>
        <p id="info-summary">A yellow dwarf star like our Sun provides heat and light necessary for life on Earth; stars create heavier elements via fusion and exhibit a lifecycle dependent on mass.</p>
        <ul>
            <li>Class: <strong id="paramClass">G (Sun)</strong></li>
            <li>Color: <strong id="paramColor">Yellow</strong></li>
            <li>Temperature: <strong id="paramTemp">~5,800 K</strong></li>
            <li>Lifespan: <strong id="paramLifespan">~10 Billion yrs</strong></li>
        </ul>

        <hr>

        <div class="info-section">
            <h3>What is a star?</h3>
            <p>Stars are massive spheres of plasma held together by gravity and powered by nuclear fusion at their cores. Fusion converts light elements into heavier ones and releases energy as light and heat.</p>
        </div>

        <div class="info-section">
            <h3>How do stars form?</h3>
            <p>Stars form from collapsing clouds of gas and dust in molecular clouds. As gravity pulls material together, the core heats up until fusion ignites, creating a new star.</p>
        </div>

        <div class="info-section">
            <h3>Lifecycle</h3>
            <p>Star lifecycles depend on mass. Low-mass stars live very long as red dwarfs; sun-like stars become red giants and then white dwarfs; massive stars may explode as supernovae and leave neutron stars or black holes.</p>
        </div>

        <div class="info-section">
            <h3>Interesting facts</h3>
            <ul>
                <li>The Sun's energy comes from fusing hydrogen into helium in its core.</li>
                <li>Elements heavier than iron are produced in supernovae and neutron star mergers.</li>
                <li>Red dwarfs are the most common stars in the galaxy, while O-type are rare but very luminous.</li>
            </ul>
        </div>
    </aside>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // 1. Scene Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 2. Star Data Configurations
        const starTypes = {
            'M': { 
                name: 'Red Dwarf (Proxima Centauri)', 
                color: 0xff3300, 
                glowColor: 0xff1100,
                colorName: 'Red',
                temp: '~3,000 K',
                lifespan: 'Trillions yrs',
                size: 0.6, 
                desc: "Small, cool, and extremely long-lived. The most common type of star in the universe.",
                rowId: 'row-m'
            },
            'G': { 
                name: 'Yellow Dwarf (The Sun)', 
                color: 0xffdd00, 
                glowColor: 0xffaa00,
                colorName: 'Yellow',
                temp: '~5,800 K',
                lifespan: '10 Billion yrs',
                size: 1.0, 
                desc: "A medium-sized star. Bright enough to warm planets, stable enough to allow life to evolve.",
                rowId: 'row-g'
            },
            'O': { 
                name: 'Blue Giant (Rigel)', 
                color: 0x00aaff, 
                glowColor: 0x0055ff,
                colorName: 'Blue',
                temp: '~30,000+ K',
                lifespan: '~10 Million yrs',
                size: 2.2, 
                desc: "Massive, incredibly hot, and short-lived. They burn through their fuel furiously.",
                rowId: 'row-o'
            }
        };

        // 3. Create the Core Sun (The solid sphere)
        const geometry = new THREE.SphereGeometry(2, 64, 64);
        const material = new THREE.MeshBasicMaterial({ color: 0xffdd00 });
        const sun = new THREE.Mesh(geometry, material);
        scene.add(sun);

        // 4. Create the Glow Atmosphere (Custom Shader)
        // This creates a fuzzy halo that always faces the camera
        const vertexShader = `
            varying vec3 vNormal;
            void main() {
                vNormal = normalize(normalMatrix * normal);
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `;

        const fragmentShader = `
            varying vec3 vNormal;
            uniform vec3 color;
            void main() {
                float intensity = pow(0.6 - dot(vNormal, vec3(0, 0, 1.0)), 4.0);
                gl_FragColor = vec4(color, 1.0) * intensity;
            }
        `;

        const glowMaterial = new THREE.ShaderMaterial({
            uniforms: {
                color: { value: new THREE.Color(0xffaa00) }
            },
            vertexShader: vertexShader,
            fragmentShader: fragmentShader,
            side: THREE.BackSide,
            blending: THREE.AdditiveBlending,
            transparent: true
        });

        const sunGlow = new THREE.Mesh(
            new THREE.SphereGeometry(2.6, 64, 64), // Slightly larger than sun
            glowMaterial
        );
        scene.add(sunGlow);

        // Add Stars to background
        const starGeo = new THREE.BufferGeometry();
        const starCount = 2000;
        const starPos = new Float32Array(starCount * 3);
        for(let i=0; i<starCount*3; i++) {
            starPos[i] = (Math.random() - 0.5) * 600;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 0.2});
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);

        // Camera Position
        camera.position.z = 7;

        // 5. Interaction Functions
        function changeStar(type) {
            const data = starTypes[type];
            
            // Animate properties (smooth transition could be added with Tweening, but direct for now)
            material.color.setHex(data.color);
            glowMaterial.uniforms.color.value.setHex(data.glowColor);
            
            // Update Size
            sun.scale.setScalar(data.size);
            sunGlow.scale.setScalar(data.size);

            // Update UI Text
            document.getElementById('star-name').innerText = data.name;
            document.getElementById('star-desc').innerText = data.desc;

            // Highlight Table Row
            document.querySelectorAll('tbody tr').forEach(r => r.classList.remove('highlight'));
            document.getElementById(data.rowId).classList.add('highlight');

            // Highlight Button (robust selection by onclick attribute)
            document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`.controls button[onclick="changeStar('${type}')"]`);
            if (btn) btn.classList.add('active');

            // Update bottom info panel to reflect selected star
            updateBottomInfo(type);
        }

        // Toggle Panel
        function toggleInfo() {
            document.getElementById('info-panel').classList.toggle('expanded');
        }
        // Prevent closing when clicking inside the content
        document.getElementById('info-content').addEventListener('click', function(e) {
            e.stopPropagation();
        });

        // Bottom info toggle and updater
        const infoBottomEl = document.getElementById('info-bottom');
        const infoToggleBtn = document.getElementById('infoToggle');
        if (infoToggleBtn) {
            infoToggleBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                infoBottomEl.classList.toggle('collapsed');
                const expanded = !infoBottomEl.classList.contains('collapsed');
                infoToggleBtn.innerText = expanded ? '▲' : '▼';
                infoToggleBtn.title = expanded ? 'Collapse panel' : 'Expand panel';
                infoToggleBtn.setAttribute('aria-expanded', expanded);
            });
        }

        function updateBottomInfo(type) {
            const data = starTypes[type];
            if (!data) return;
            document.getElementById('paramClass').textContent = data.name;
            document.getElementById('paramColor').textContent = data.colorName || '—';
            document.getElementById('paramTemp').textContent = data.temp || '—';
            document.getElementById('paramLifespan').textContent = data.lifespan || '—';

            // also update the brief summary to include the selected star's type
            const summary = document.getElementById('info-summary');
            if (summary) summary.textContent = `${data.name} — ${data.desc}`;
        }

        // Initialize bottom info with default 'G' star
        updateBottomInfo('G');

        // 6. Animation Loop
        function animate() {
            requestAnimationFrame(animate);

            // Rotate Sun
            sun.rotation.y += 0.002;
            
            // Pulse Effect
            const time = Date.now() * 0.001;
            sunGlow.scale.setScalar(sun.scale.x + Math.sin(time) * 0.02);

            renderer.render(scene, camera);
        }
        animate();

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>